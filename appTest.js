Feature('App')

const tag = 'PHNjcmlwdCBzcmM9Im1yYWlkLmpzIj48L3NjcmlwdD4KPGRpdiBjbGFzcz0iY2VsdHJhLWFkLXYzIj4KICAgIDwhLS0gcGFzc3Rocm91Z2hQYXJhbWV0ZXJzW3Rlc3RQYXNzdGhyb3VnaFBhcmFtXSA9IHJhdyB0ZXN0IC0tPgogICAgPGltZyBzcmM9ImRhdGE6aW1hZ2UvcG5nLGNlbHRyYSIgc3R5bGU9ImRpc3BsYXk6IG5vbmUiIG9uZXJyb3I9IgogICAgICAgIChmdW5jdGlvbihpbWcpIHsKICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHsnYWNjb3VudElkJzonYzhkMWFlNzEnLCdjbGlja1VybCc6JycsJ3BsYWNlbWVudElkJzonN2Q4NDkxZTcnLCdjbGlja0V2ZW50JzonYWR2ZXJ0aXNlcicsJ2V4dGVybmFsQWRTZXJ2ZXInOidDdXN0b20nLCd0YWdWZXJzaW9uJzonaHRtbC1zdGFuZGFyZC03J307CiAgICAgICAgICAgIFtdLnNsaWNlLmFwcGx5KGltZy5wYXJlbnROb2RlLmNoaWxkTm9kZXMpLmZvckVhY2goZnVuY3Rpb24obikgeyB2YXIgZGVjZnMgPSB7IHVybGRlY29kZTogZGVjb2RlVVJJQ29tcG9uZW50LCBodG1sZGVjb2RlOiBmdW5jdGlvbih2KSB7IHZhciBkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7IGQuaW5uZXJIVE1MID0gdjsgcmV0dXJuIGQudGV4dENvbnRlbnQ7IH0sIGV2YWw6IGZ1bmN0aW9uKHYpIHsgcmV0dXJuIGV2YWwodik7IH0sIHJhdzogZnVuY3Rpb24odikgeyByZXR1cm4gdjsgfSB9OyB2YXIgbTsgaWYgKG4ubm9kZVR5cGUgPT0gOCAmYW1wOyZhbXA7IChtID0gbi50ZXh0Q29udGVudC5tYXRjaCgvXiYjOTI7cysoWyYjOTI7dyUuXSspKCYjOTI7Wy4rJiM5MjtdKT8mIzkyO3MrPSYjOTI7cysoJiM5Mjt3KykmIzkyO3MrKC4qKSQvaSkpKSB7IHRyeSB7IHBhcmFtc1ttWzFdKyhtWzJdIHx8ICcnKV0gPSBkZWNmc1ttWzNdXShtWzRdLnJlcGxhY2UoL14mIzkyO3MrfCYjOTI7cyskL2csICcnKSk7IH0gY2F0Y2ggKGUpIHt9IH0gfSk7CiAgICAgICAgICAgIHZhciByZXEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsKICAgICAgICAgICAgcmVxLmlkID0gcGFyYW1zLnNjcmlwdElkID0gJ2NlbHRyYS1zY3JpcHQtJyArICh3aW5kb3cuY2VsdHJhU2NyaXB0SW5kZXggPSAod2luZG93LmNlbHRyYVNjcmlwdEluZGV4fHwwKSsxKTsKICAgICAgICAgICAgcGFyYW1zLmNsaWVudFRpbWVzdGFtcCA9IG5ldyBEYXRlLzEwMDA7CiAgICAgICAgICAgIHBhcmFtcy5jbGllbnRUaW1lWm9uZU9mZnNldEluTWludXRlcyA9IG5ldyBEYXRlKCkuZ2V0VGltZXpvbmVPZmZzZXQoKTsKICAgICAgICAgICAgcGFyYW1zLmhvc3RQYWdlTG9hZElkPXdpbmRvdy5jZWx0cmFIb3N0UGFnZUxvYWRJZD13aW5kb3cuY2VsdHJhSG9zdFBhZ2VMb2FkSWR8fChNYXRoLnJhbmRvbSgpKycnKS5zbGljZSgyKTsKICAgICAgICAgICAgdmFyIHFzID0gJyc7CiAgICAgICAgICAgIGZvciAodmFyIGsgaW4gcGFyYW1zKSB7CiAgICAgICAgICAgICAgICBxcyArPSAnJmFtcDsnICsgZW5jb2RlVVJJQ29tcG9uZW50KGspICsgJz0nICsgZW5jb2RlVVJJQ29tcG9uZW50KHBhcmFtc1trXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIHNyYyA9ICdodHRwczovL2Fkcy5jZWx0cmEuY29tLzVmYWM4ZjU4L21yYWlkLWFkLmpzPycgKyBxczsKICAgICAgICAgICAgcmVxLnNyYyA9IHNyYzsKICAgICAgICAgICAgaW1nLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHJlcSwgaW1nLm5leHRTaWJsaW5nKTsKICAgICAgICB9KSh0aGlzKTsKICAgICIvPgo8L2Rpdj4='

Scenario('Failing interstitial', ({ I }) => {
    I.amOnPage(`app-preview-celtra.com://preview?tag=${encodeURIComponent(tag)}&tagType=HTML&layout=I&size=undefined&sdk=dfp`)

    I.waitForElement('#com.celtra.adpreview:id/bt_showInterstitial', 10)
    I.click('#com.celtra.adpreview:id/bt_showInterstitial')
    // I.wait(10)
})